<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>需求说明书</title>
    <style>
        body {
            max-width: 860px;
            margin: 32px auto;
            padding: 0 16px;
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #1f2937;
        }
        pre { background:#f8fafc; padding:12px; overflow:auto; border-radius:6px; }
        code { background:#f1f5f9; padding:2px 4px; border-radius:4px; }
        h1,h2,h3,h4,h5,h6 { line-height:1.25; }
        a { color:#2563eb; text-decoration:none; }
        a:hover { text-decoration:underline; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #e5e7eb; padding: 8px; }
        blockquote { margin: 0; padding-left: 1em; border-left: 4px solid #e5e7eb; color:#6b7280; }
    </style>
</head>
<body>
<p>﻿# 基于比特承诺模型的去中心化投票系统需求说明书</p>
<p>> 用词规范：请参阅《[项目术语表](项目术语表.md)》以确保术语统一。</p>
<br/>
<h2>1. 项目概述</h2>
<br/>
<h3>1.1 项目背景</h3>
<p>随着区块链技术的发展，去中心化应用在各个领域得到广泛应用。去中心化决策投票系统作为集体决策的重要工具，需要确保决策结果的公平性、透明性和可验证性。本项目旨在构建一个基于比特承诺模型的去中心化决策投票系统，结合Rust WebAssembly高性能计算与区块链技术的不可篡改特性，支持大规模决策场景。</p>
<br/>
<p>去中心化的定义与核心特征：</p>
<p>- 分散与平等：每个参与者的决策权形式上完全平等，对结果影响同等重要。</p>
<p>- 全员一致性共识：任何结果由全体参与者偏好叠加产生，不依赖任何个人或子集。</p>
<p>- 抗合谋与抗操纵：协议与规则防止任何规模的子集（含51%/99%）主导或篡改结果。</p>
<p>- 偏好显示自由性：任何参与者不能通过伪造偏好获得绝对额外收益。</p>
<p>- 透明与可验证：全过程对全体参与者透明，人人可独立验证结果的真实性与合法性。</p>
<br/>
<p>#### 1.1.2 决策类型统一术语与分类</p>
<br/>
<p>- **概念定位声明**：以下类型均为系统内置的“NFT类型”，它们独立于具体应用场景；不同应用场景通过“选择/引用对应的NFT类型”来获得相应的决策能力。</p>
<br/>
<p>- **按结果基数分类**：</p>
<p>  - **单目标决策**：每次仅产生一个获胜结果，从n个候选人中选择1个中奖人。</p>
<p>    - 实例：单一中奖抽奖、单提案通过投票、唯一获奖者评选</p>
<p>    - 特点：结果唯一，竞争激烈，适用于需要明确单一获胜者的场景</p>
<p>  - **多目标决策**：一次产生多个互不冲突的获胜结果，从n个候选人中选择k个中奖人，奖励相同。</p>
<p>    - 实例：多人中奖抽奖（如从100人中选出10个获奖者）、多席位选举、批量奖励分配</p>
<p>    - 特点：多个获胜者，奖励均等，适用于需要批量选择获胜者的场景</p>
<p>  - **多等级决策**：从n个候选人中选择k组中奖人，每组内部奖励相同，不同组之间奖励不同。</p>
<p>    - 实例：等级化抽奖（一等奖1名、二等奖3名、三等奖5名）、分级奖励系统、多层级评选</p>
<p>    - 特点：分层奖励，激励差异化，适用于需要建立奖励梯度的场景</p>
<br/>
<p>- **按资源属性分类**：</p>
<p>  - **竞用性资源决策**：资源有限且排他，名额/额度等有限资源分配。</p>
<p>    - 实例：有限名额分配、固定预算分配、排他性奖励</p>
<p>  - **非竞用性资源决策**：资源非排他，可并行满足，公共品偏好表达。</p>
<p>    - 实例：公共设施偏好投票、非排他性政策选择、并行满足的需求表达</p>
<br/>
<p>- **扩展性**：通过NFT类型抽象承载，未来可新增更多决策类型，支持灵活的场景配置和规则定制。</p>
<br/>
<p>> 应用场景与NFT类型的典型映射（示例）：</p>
<p>> - 去中心化抽奖：可调用“单目标决策NFT类型”或“多目标决策NFT类型”。</p>
<p>> - 去中心化彩票：可调用“多等级决策NFT类型”。</p>
<p>> - 去中心化盲盒、去中心化游戏发牌：可调用“多等级决策NFT类型”。</p>
<p>> - 去中心化资源分配：可调用“竞用性资源决策NFT类型”。</p>
<p>> - 去中心化治理：可调用“非竞用性资源决策NFT类型”。</p>
<br/>
<p>#### 1.1.1 具体应用场景</p>
<p>系统支持多种去中心化决策投票应用场景，这些应用场景通过使用者创建不同的NFT类型来进行控制。以下是几个典型示例：</p>
<br/>
<p>**应用场景1：去中心化抽奖**</p>
<p>以去中心化抽奖为例，系统的工作流程如下：</p>
<p>1. **NFT分发**：系统通过分发抽奖NFT来管理参与者，替代传统的用户注册功能</p>
<p>2. **提交随机数**：每个NFT持有者提交一个整数作为自己的随机数</p>
<p>3. **隐私保护**：使用比特承诺协议保护每个参与者的随机数不被泄露</p>
<p>4. **结果计算**：系统累加所有参与者的整数之和，并对投票总人数进行取余</p>
<p>5. **结果验证**：最终得到的余数作为抽奖结果，整个过程透明可验证</p>
<br/>
<p>例如：有5个参与者，分别提交整数[3, 7, 2, 9, 1]，总和为22，对5取余得到2，则抽奖结果为2号参与者。</p>
<br/>
<p>**多目标决策（n选k）示例**</p>
<p>- 场景：从 n=10 个参与者中选出 k=3 名中奖者，三名中奖者奖励相同。</p>
<p>- 规则：每个参与者提交 3 个整数值 [a1, a2, a3]。</p>
<p>  - 第1列（a1）按所有参与者求和并对 n 取余，得到第1名中奖者编号（若为0，则映射为 n）。</p>
<p>  - 第2列（a2）按所有参与者求和并对 n 取余，得到“相对于第1名”的偏移步数。</p>
<p>  - 第3列（a3）按所有参与者求和并对 n 取余，得到“相对于第2名”的偏移步数。</p>
<p>  - 若命中已出现的编号，则“顺序下延一个”（按 1..n 循环前进），直到找到未使用编号。</p>
<p>- 示例输入（展示用，列出 5 位参与者；其余参与者可视为 0 不影响示例理解）：</p>
<p>  - 参与者1：[4, 2, 1]</p>
<p>  - 参与者2：[7, 3, 5]</p>
<p>  - 参与者3：[0, 9, 2]</p>
<p>  - 参与者4：[6, 4, 1]</p>
<p>  - 参与者5：[8, 7, 3]</p>
<p>- 按列求和并取余（n=10）：</p>
<p>  - S1 = 4+7+0+6+8 = 25 → base1 = 25 % 10 = 5 → 第1名 = 5</p>
<p>  - S2 = 2+3+9+4+7 = 25 → off2  = 25 % 10 = 5</p>
<p>  - S3 = 1+5+2+1+3 = 12 → off3  = 12 % 10 = 2</p>
<p>- 计算第2名（相对第1名顺序偏移 off2=5，遇占用则顺延）：</p>
<p>  - 从 5 开始，依次前进未占用编号：6(1), 7(2), 8(3), 9(4), 10(5) → 第2名 = 10</p>
<p>- 计算第3名（相对第2名顺序偏移 off3=2，跳过已占用 {5,10}）：</p>
<p>  - 从 10 开始，依次前进未占用编号：1(1), 2(2) → 第3名 = 2</p>
<p>- 最终结果：中奖者为 {5, 10, 2}（排序后展示）。</p>
<p>- 说明：</p>
<p>  - 该示例体现“按列求和取余 + 顺序下延”的唯一性与可验证流程；</p>
<p>  - 实际实现中可用更多参与者数据，或对各列应用不同盐/哈希域，确保抗操纵与可审计。</p>
<br/>
<p>**多等级决策（多组 n选k）示例**</p>
<p>- 场景：有 n 个参与者，需依次选出：一等奖 2 名、二等奖 5 名、三等奖 10 名。</p>
<p>- 提交规则：每个参与者需提交三组数字（按等级各一组）：</p>
<p>  - 组A（一等奖）：2 个数 [a1, a2]</p>
<p>  - 组B（二等奖）：5 个数 [b1, b2, b3, b4, b5]</p>
<p>  - 组C（三等奖）：10 个数 [c1, c2, c3, c4, c5, c6, c7, c8, c9, c10]</p>
<p>- 处理规则：对每个等级各自“按列求和取余 + 顺序下延”独立计算一次，方法与多目标决策（n选k）完全相同：</p>
<p>  - 等级的第1列按所有参与者求和并对 n 取余得到“该等级第1名”的编号（0 映射为 n）。</p>
<p>  - 等级的第 j 列（j>1）按所有参与者求和并对 n 取余得到“相对上一名”的偏移步数；遇已占用则顺序下延至未占用编号。</p>
<p>- 跨等级去重：按从高到低的等级顺序进行去重。若低等级命中高等级已选编号，则对该低等级集合按“顺序下延”替换，直至不与更高等级冲突。</p>
<p>- 示例（描述性）：</p>
<p>  1) 先计算组A（k=2）得到一等奖 2 名；</p>
<p>  2) 再计算组B（k=5）得到二等奖 5 名，并与一等奖集合去重，必要时顺延替换；</p>
<p>  3) 最后计算组C（k=10）得到三等奖 10 名，并与前两组去重，必要时顺延替换。</p>
<p>- 说明：</p>
<p>  - 各等级彼此独立聚合（可以使用不同盐/哈希域），确保可审计与抗操纵；</p>
<p>  - 输出需包含列求和、取余、偏移与去重的中间数据与证明（链上摘要 + IPFS 明细）。</p>
<br/>
<p>**应用场景2：去中心化彩票**</p>
<p>去中心化彩票系统的工作流程：</p>
<p>1. **彩票NFT分发**：用户获得彩票NFT，替代传统注册流程</p>
<p>2. **偏好提交**：每个彩票NFT持有者提交偏好值（如幸运数字）</p>
<p>3. **隐私保护**：使用比特承诺协议保护偏好值不被泄露</p>
<p>4. **开奖计算**：系统汇总所有偏好值，通过算法生成开奖号码</p>
<p>5. **中奖验证**：验证中奖彩票，自动分配奖金</p>
<br/>
<p>**应用场景3：去中心化分配**</p>
<p>去中心化分配系统的工作流程：</p>
<p>1. **资源分配NFT分发**：参与者获得资源分配NFT</p>
<p>2. **偏好表达**：参与者提交对资源的偏好值</p>
<p>3. **隐私保护**：使用比特承诺协议保护偏好信息</p>
<p>4. **分配计算**：基于偏好值计算最优分配方案</p>
<p>5. **结果执行**：自动执行分配结果，更新资源状态</p>
<br/>
<p>**应用场景4：去中心化治理投票**</p>
<p>治理投票系统的工作流程：</p>
<p>1. **治理NFT分发**：参与者获得治理投票NFT</p>
<p>2. **偏好投票**：参与者提交对提案的偏好值</p>
<p>3. **隐私保护**：使用比特承诺协议保护投票偏好</p>
<p>4. **结果统计**：汇总所有偏好值，计算最终决策</p>
<p>5. **决策执行**：根据投票结果自动执行相应决策</p>
<br/>
<h3>1.2 项目目标</h3>
<p>- 实现隐私保护的投票机制</p>
<p>- 确保投票数据的完整性与可验证性</p>
<p>- 支持百万级用户规模</p>
<p>- 平衡性能与去中心化程度</p>
<p>- 满足“五大去中心化原则”并贯穿系统各领域应用</p>
<p>- 实现基于代币持有量的权限控制</p>
<p>- **支持通过NFT类型控制不同应用场景（类型独立于场景）**</p>
<p>- **实现NFT分发替代用户注册功能**</p>
<p>- **实现NFT全局状态变量控制比特承诺功能**</p>
<p>- 实现多等级选择（多组多目标选择）系统</p>
<p>- 第一阶段仅支持去中心化抽奖（n选1、n选k），其他场景（彩票、分配、治理）后续迭代</p>
<p>- 提供可扩展的应用场景框架</p>
<br/>
<h3>1.3 技术约束</h3>
<p>- 必须使用Rust + WebAssembly作为服务器端核心逻辑</p>
<p>- 必须使用区块链平台 Injective（CosmWasm 生态）</p>
<p>- 必须实现比特承诺协议</p>
<p>- 保护用户隐私，私钥等信息不提交到后台</p>
<p>- 必须支持$LUCKEE代币持有验证</p>
<p>- 必须实现NFT创建和管理功能</p>
<p>- **必须实现NFT类型控制应用场景的机制**</p>
<p>- **必须实现NFT全局状态变量管理**</p>
<br/>
<h3>1.4 项目范围（In Scope）</h3>
<p>- 基于比特承诺的偏好/随机数承诺与揭示流程</p>
<p>- 基于NFT类型的多应用场景（抽奖、彩票、分配、治理）配置与流转</p>
<p>- $LUCKEE 代币持有验证与权限控制（含质押/锁定扩展预留）</p>
<p>- 统一NFT决策状态机及状态审计事件</p>
<p>- 链上最小化存储与IPFS明细存储、可验证完整性链路</p>
<p>- 多目标选择（n选k）与多等级（多组多目标选择）算法与验证</p>
<p>- iAgent 自动化（承诺/揭示）的策略、触发与审计</p>
<br/>
<h3>1.5 非范围（Out of Scope）</h3>
<p>- 法币出入金与中心化托管功能</p>
<p>- 非本项目发行的证券型代币设计与募资安排</p>
<p>- 跨链资产桥接与多链治理（仅预留接口，不纳入首期实现）</p>
<p>- 零知识证明电路实现细节（不在本期范围）</p>
<p>- 去中心化彩票、去中心化分配、去中心化治理（纳入后续迭代）</p>
<br/>
<h2>2. 功能需求</h2>
<br/>
<h3>2.1 NFT类型管理模块</h3>
<p>#### 2.1.1 NFT类型创建</p>
<p>- **功能描述**：使用者通过创建不同的NFT类型来控制不同的应用场景</p>
<p>- **输入**：NFT类型定义、应用场景配置、元数据模式</p>
<p>- **输出**：NFT类型ID、创建确认、应用场景配置</p>
<p>- **约束**：只有持有足够$LUCKEE代币的账户才能创建NFT类型</p>
<br/>
<p>#### 2.1.2 应用场景配置</p>
<p>- **功能描述**：根据NFT类型配置相应的应用场景参数和规则</p>
<p>- **输入**：NFT类型、应用场景配置、规则设置</p>
<p>- **输出**：配置确认、配置ID列表</p>
<p>- **约束**：只有NFT类型创建者可以设置应用场景配置</p>
<br/>
<p>**具体配置类型：**</p>
<p>- **抽奖NFT类型配置**：设置不同等级与每个等级的数量（即多个 n 选 k 组合）</p>
<p>- **彩票NFT类型配置**：设置彩票类型、开奖规则、奖金分配</p>
<p>- **分配NFT类型配置**：设置资源分配算法、权重参数、约束条件</p>
<p>- **治理NFT类型配置**：设置投票规则、提案流程、决策阈值</p>
<br/>
<h3>2.2 NFT决策接口（抽象需求）</h3>
<p>- 提案/会话创建：设置NFT类型与时间参数</p>
<p>- 偏好投票提交：提交偏好值</p>
<p>- 隐私保护：使用比特承诺提交承诺与盐</p>
<p>- 揭示与计票：验证承诺并计算最终结果</p>
<p>- 决策执行：根据结果自动执行相应决策</p>
<br/>
<h3>2.3 NFT分发管理模块</h3>
<p>#### 2.2.1 NFT分发替代用户注册</p>
<p>- **功能描述**：使用NFT的分发代替传统的用户注册功能</p>
<p>- **输入**：用户地址、NFT类型、分发策略</p>
<p>- **输出**：NFT ID、分发确认、用户资格确认</p>
<p>- **约束**：NFT分发必须验证用户资格，支持批量分发</p>
<br/>
<p>#### 2.2.2 NFT资格验证</p>
<p>- **功能描述**：验证用户是否拥有参与特定应用场景的NFT</p>
<p>- **输入**：用户地址、NFT类型、应用场景ID</p>
<br/>
<h3>2.4 多目标选择模块（抽奖/彩票的选择模式）</h3>
<p>#### 2.3.1 多目标选择会话管理</p>
<p>- **功能描述**：创建和管理多目标选择会话，支持从n个参与者中选出k个不同目标</p>
<p>- **输入**：参与者数量n、目标数量k、会话配置、时间窗口设置</p>
<p>- **输出**：会话ID、会话状态、配置确认</p>
<p>- **约束**：只有系统管理员可以创建多目标选择会话</p>
<br/>
<p>#### 2.3.2 AI代理自动化</p>
<p>- **功能描述**：通过AI代理自动化处理承诺和揭示过程，减少用户操作负担</p>
<p>- **输入**：自动化配置、触发条件、执行策略</p>
<p>- **输出**：自动化状态、执行日志、操作确认</p>
<p>- **约束**：AI代理必须经过身份验证，操作权限受NFT状态控制</p>
<br/>
<p>#### 2.3.3 公平选择算法</p>
<p>- **功能描述**：实现公平的多目标选择算法，确保每个参与者的选择都影响最终结果</p>
<p>- **输入**：参与者选择值、算法参数、验证规则</p>
<p>- **输出**：中奖序号列表、计算证明、验证报告</p>
<p>- **约束**：算法必须确保所有中奖序号互不相同，支持大规模参与者</p>
<br/>
<p>#### 2.3.4 关系与偏好组说明</p>
<p>- 唯一中奖：n 选 1（k=1），为多目标选择特例。</p>
<p>- 多等级选择：等价于多个 n 选 k 的组合，各等级独立配置 k 与规则；定义为“多组多目标选择”。</p>
<p>- 偏好映射：单个 n 选 k 使用 1 组偏好值；多个 n 选 k（如多等级）使用多组偏好值（各会话/等级各一组）。</p>
<br/>
<p>#### 2.3.5 会话状态管理</p>
<p>- **功能描述**：管理多目标选择会话的完整生命周期，包括创建、注册、承诺、揭示、计算、验证等阶段</p>
<p>- **输入**：状态变更请求、验证数据、状态参数</p>
<p>- **输出**：状态确认、状态历史、状态报告</p>
<p>- **约束**：状态转换必须遵循预定义的状态机规则，支持状态回滚</p>
<br/>
<h3>2.5 统一NFT决策状态机（需求）</h3>
<p>状态：Draft → CommitOpen → CommitClosed → RevealOpen → Revealed → Tallied → Executed → Archived</p>
<br/>
<p>- 提供时间参数控制提交/揭示窗口；</p>
<p>- 承诺/揭示与状态联动；</p>
<p>- 结果聚合与执行受NFT类型规则约束；</p>
<p>- 全流程事件审计与可验证性支持。</p>
<p>- **输出**：资格验证结果、NFT信息</p>
<p>- **约束**：只有拥有对应NFT类型的用户才能参与相应应用场景</p>
<br/>
<h3>2.6 NFT全局状态管理模块</h3>
<p>#### 2.3.1 全局状态变量管理</p>
<p>- **功能描述**：NFT存在一个全局的状态变量，用于比特承诺功能的状态控制</p>
<p>- **输入**：NFT状态更新、状态变更请求</p>
<p>- **输出**：状态更新确认、新状态值</p>
<p>- **约束**：状态变更必须通过智能合约验证，支持状态回滚</p>
<br/>
<p>#### 2.3.2 比特承诺状态控制</p>
<p>- **功能描述**：比特承诺合约通过NFT的接口来判断自身的状态，并执行对应的操作</p>
<p>- **输入**：NFT状态查询、状态变更通知</p>
<p>- **输出**：状态信息、操作执行结果</p>
<p>- **约束**：状态控制必须确保原子性，防止状态不一致</p>
<br/>
<h3>2.7 投票项目管理（作为NFT管理的属性接口）</h3>
<p>#### 2.4.1 概念修正与边界</p>
<p>- **定位修正**：投票项目管理不是独立模块，而是**NFT管理**的一个属性接口；其配置项均为对应NFT类型的**全局参数**（如时间窗口、偏好范围、阈值、是否抽奖/多目标等）。</p>
<p>- **数据位置**：</p>
<p>  - **IPFS（主要存储）**：投票决策的详细数据（承诺/揭示明细、参与者列表、计算过程与证明、会话完整配置）全部存储在IPFS；链上保存其CID/哈希用于完整性校验。</p>
<p>  - **链上（最小记录集）**：仅记录账户与NFT的关联信息（持有/转移）以及投票结果信息（结果哈希/CID、必要的摘要字段）。</p>
<br/>
<p>#### 2.4.2 基于NFT类型的参数配置</p>
<p>- **功能描述**：为特定`NFT类型`设置/更新投票相关的全局参数（如提交/揭示时间、偏好范围、是否启用多目标/抽奖等）。</p>
<p>- **输入**：NFT类型、参数键值对（全局参数集合）、版本号/生效时间（可选）</p>
<p>- **输出**：参数更新确认、版本号、链上结果摘要或CID</p>
<p>- **约束**：参数变更遵循权限与状态机约束；变更详情写入IPFS，链上仅存摘要/哈希。</p>
<br/>
<p>#### 2.4.3 NFT类型化投票行为控制</p>
<p>- **功能描述**：根据NFT类型全局参数控制投票行为（资格、阶段、计票策略选择等）。</p>
<p>- **输入**：NFT类型、投票配置引用（CID/版本号）</p>
<p>- **输出**：行为控制确认、事件审计</p>
<p>- **约束**：不同NFT类型可有不同规则；规则详情在IPFS，链上只保留必要的结果摘要。</p>
<br/>
<h3>2.8 决策投票管理模块</h3>
<p>#### 2.5.1 基于NFT的投票资格验证</p>
<p>- **功能描述**：验证用户是否拥有参与投票的NFT</p>
<p>- **输入**：用户地址、NFT类型</p>
<p>- **输出**：投票资格验证结果</p>
<p>- **约束**：只有拥有对应NFT类型的账户才具有投票资格</p>
<br/>
<p>#### 2.5.2 偏好投票参与</p>
<p>- **功能描述**：决策人参与决策投票活动，提交偏好值</p>
<p>- **输入**：决策投票ID、偏好值（整数）、NFT证明、NFT类型</p>
<p>- **输出**：偏好投票承诺、参与确认</p>
<p>- **约束**：使用比特承诺保护隐私，偏好值必须在有效范围内，必须拥有对应NFT类型</p>
<br/>
<p>**不同NFT类型的偏好值含义：**</p>
<p>- **抽奖NFT类型**：偏好值作为随机数，用于抽奖结果计算</p>
<p>- **彩票NFT类型**：偏好值作为幸运数字，影响开奖概率</p>
<p>- **资源分配NFT类型**：偏好值表示对资源的偏好程度，用于分配算法</p>
<p>- **治理投票NFT类型**：偏好值表示对提案的支持程度，用于决策计算</p>
<br/>
<h3>2.9 资源分配型投票（决策方式划分）</h3>
<p>- **竞用性决策**：资源有限且排他（名额/额度等），需避免冲突与重叠；支持约束与最优匹配。</p>
<p>- **非竞用性决策**：资源非排他，可并行满足（公共品偏好表达），侧重偏好强度与阈值满足。</p>
<br/>
<p>#### 2.8.3 偏好投票验证</p>
<p>- **功能描述**：验证偏好投票的有效性</p>
<p>- **输入**：偏好投票承诺、验证参数、NFT所有权证明、NFT类型</p>
<p>- **输出**：验证结果</p>
<p>- **约束**：确保偏好投票不可篡改，验证偏好值格式，验证NFT类型和所有权</p>
<br/>
<p>#### 2.8.4 iAgent自动化投票管理</p>
<p>- **功能描述**：通过iAgent实现承诺与揭示流程的自动化管理</p>
<p>- **输入**：自动化配置、承诺策略、揭示条件、NFT类型状态</p>
<p>- **输出**：自动化投票ID、执行状态、自动化结果</p>
<p>- **约束**：支持多种自动化策略，确保自动化流程的安全性和可验证性，基于NFT状态执行</p>
<br/>
<p>**具体自动化功能：**</p>
<p>- **自动承诺策略**：</p>
<p>  - 立即承诺：用户设置后立即执行承诺操作</p>
<p>  - 定时承诺：在指定时间自动执行承诺操作</p>
<p>  - 条件触发承诺：满足特定条件时自动执行承诺操作</p>
<p>  - 批量承诺：收集多个承诺后批量执行</p>
<br/>
<p>- **自动揭示策略**：</p>
<p>  - 基于时间：在指定时间自动执行揭示操作</p>
<p>  - 基于参与者数量：达到指定参与者数量时自动揭示</p>
<p>  - 基于投票完成度：投票完成度达到阈值时自动揭示</p>
<p>  - 智能触发：基于NFT状态智能判断揭示时机</p>
<br/>
<p>- **自动化监控**：</p>
<p>  - 实时监控投票状态和自动化执行情况</p>
<p>  - 提供自动化执行日志和状态查询</p>
<p>  - 支持自动化配置的动态更新和调整</p>
<p>  - 基于NFT状态进行自动化决策</p>
<br/>
<h3>2.10 决策结果管理模块</h3>
<p>#### 2.10.1 偏好汇总计算</p>
<p>- **功能描述**：汇总所有决策人的偏好值，计算最终决策结果（如抽奖结果）</p>
<p>- **输入**：所有有效偏好投票承诺、NFT类型信息</p>
<p>- **输出**：决策结果、偏好汇总统计信息</p>
<p>- **约束**：确保计算过程透明，结果准确反映全体决策人偏好</p>
<br/>
<p>#### 2.10.2 决策结果验证</p>
<p>- **功能描述**：验证决策结果的正确性和计算过程的透明度</p>
<p>- **输入**：决策结果、验证参数、NFT类型状态</p>
<p>- **输出**：验证结果</p>
<p>- **约束**：支持公开验证，任何人都可验证计算过程</p>
<br/>
<p>#### 2.10.3 应用场景结果计算</p>
<p>- **功能描述**：根据不同NFT类型计算相应的最终结果</p>
<p>- **输入**：所有参与者的偏好值、NFT类型配置</p>
<p>- **输出**：应用场景特定的结果数据</p>
<p>- **计算规则**：基于所有参与者的偏好值，根据NFT类型配置计算最终结果</p>
<br/>
<p>**不同NFT类型的结果类型：**</p>
<p>- **抽奖NFT类型结果计算**：</p>
<p>  - 输入：所有参与者的随机数、等级配置（多等级选择时为多组多目标选择）</p>
<p>  - 输出：结果（各等级的选择/中奖者列表）</p>
<p>  - 计算规则：累加所有随机数之和，对参与者总数取余，根据等级配置分配结果</p>
<p>- **彩票NFT类型开奖计算**：计算彩票开奖号码和中奖者</p>
<p>  - 输入：所有彩票持有者的幸运数字、彩票规则配置</p>
<p>  - 输出：开奖号码、中奖彩票列表、奖金分配</p>
<p>  - 计算规则：基于幸运数字的哈希值生成开奖号码，根据规则匹配中奖彩票</p>
<p>- **资源分配NFT类型计算**：计算最优的资源分配方案</p>
<p>  - 输入：所有参与者的资源偏好、分配算法配置</p>
<p>  - 输出：资源分配结果、分配证明</p>
<p>  - 计算规则：使用优化算法（如匈牙利算法）计算最优分配方案</p>
<p>- **治理投票NFT类型计算**：计算治理提案的最终决策</p>
<p>  - 输入：所有参与者的投票偏好、治理规则配置</p>
<p>  - 输出：决策结果、执行建议</p>
<p>  - 计算规则：根据投票偏好和权重计算决策得分，应用决策阈值</p>
<p>- **约束**：确保计算过程透明，结果不可篡改，支持多等级中奖</p>
<br/>
<p>#### 2.10.4 序号/结果分配</p>
<p>- **功能描述**：为每个NFT分配与投票相关的中奖序号</p>
<p>- **输入**：NFT信息、投票数据、NFT类型配置</p>
<p>- **输出**：中奖序号分配结果</p>
<p>- **约束**：序号/结果必须与投票数据关联，支持多等级（多组）分配</p>
<br/>
<h3>2.11 存储管理模块</h3>
<p>#### 2.11.1 链上存储（最小化）</p>
<p>- **功能描述**：仅将最小必要数据存储到区块链</p>
<p>- **输入**：</p>
<p>  - 账户与NFT的关联信息（持有、转移的事件与当前所有权）</p>
<p>  - 决策结果摘要（结果哈希/CID、必要的统计摘要）</p>
<p>  - 少量索引/指针（指向IPFS详细数据的CID）</p>
<p>- **输出**：交易哈希、最小化存储确认</p>
<p>- **约束**：严格最小化链上数据量，优化Gas成本；完整明细不入链。</p>
<br/>
<p>#### 2.11.2 IPFS去中心化存储（主要存储）</p>
<p>- **功能描述**：存储完整的投票与配置明细</p>
<p>- **输入**：</p>
<p>  - 决策投票全量详情（承诺/揭示明细、参与者、计算过程与证明、事件日志）</p>
<p>  - NFT信息与元数据、NFT类型的完整配置版本</p>
<p>  - 审计与验证材料</p>
<p>- **输出**：IPFS CID、访问链接</p>
<p>- **约束**：以CID为单一真实源，链上仅保存摘要/索引以验证完整性与可用性。</p>
<br/>
<p>#### 2.11.3 NFT元数据存储</p>
<p>- **功能描述**：存储NFT的元数据信息和状态</p>
<p>- **输入**：NFT属性、NFT类型全局参数配置引用（CID/版本）、中奖序号、NFT状态</p>
<p>- **输出**：元数据URI、存储确认</p>
<p>- **约束**：元数据引用配置CID作为来源，支持中奖序号关联，包含NFT状态信息</p>
<br/>
<h2>3. 非功能需求</h2>
<br/>
<h3>3.1 性能需求</h3>
<p>- **响应时间**：偏好投票操作响应时间不超过3秒</p>
<p>- **吞吐量**：支持每秒1000+并发偏好投票操作</p>
<p>- **扩展性**：支持百万级决策人规模</p>
<p>- **可用性**：系统可用性达到99.9%</p>
<p>- **NFT类型扩展性**：支持动态添加新的NFT类型而不影响系统性能</p>
<p>- **多目标选择性能**：会话创建时间 ≤ 3秒，参与者注册时间 ≤ 2秒，承诺处理时间 ≤ 5秒（1000参与者），揭示处理时间 ≤ 8秒（1000参与者），中奖计算时间 ≤ 10秒（1000参与者，10个目标）</p>
<br/>
<h3>3.2 安全需求</h3>
<p>- **隐私保护**：偏好投票内容对第三方不可见</p>
<p>- **数据完整性**：确保偏好投票数据不被篡改</p>
<p>- **身份验证**：防止身份伪造和重复投票</p>
<p>- **抗攻击性**：抵御常见的网络攻击</p>
<p>- **抗合谋与抗操纵**：协议规则对任何规模子集的联合行动具备鲁棒性</p>
<p>- **NFT状态安全**：确保NFT状态变量的安全性和一致性</p>
<p>- **自动化安全**：iAgent自动化操作需要身份验证和权限验证，防止未授权访问和恶意自动化操作</p>
<p>- **偏好保护**：确保决策人的偏好值在揭示前不被泄露</p>
<p>- **防重放攻击**：防止投票被重复提交</p>
<br/>
<h3>3.3 可靠性需求</h3>
<p>- **容错性**：系统在部分节点故障时仍能正常运行</p>
<p>- **数据备份**：关键数据多重备份</p>
<p>- **恢复能力**：系统故障后能快速恢复</p>
<p>- **监控告警**：实时监控系统状态和异常</p>
<p>- **NFT状态一致性**：确保NFT状态在所有节点间保持一致</p>
<p>- **自动化可靠性**：iAgent自动化服务具备故障转移能力，支持自动化任务的自动重试和恢复机制</p>
<br/>
<h3>3.4 兼容性需求</h3>
<p>- **平台兼容**：支持主流操作系统和浏览器</p>
<p>- **标准兼容**：遵循相关密码学和区块链标准</p>
<p>- **接口兼容**：提供标准化的API接口</p>
<p>- **NFT类型兼容**：支持不同NFT类型之间的兼容性和互操作性</p>
<br/>
<h2>4. 系统约束</h2>
<br/>
<h3>4.1 技术约束</h3>
<p>- 必须使用Rust语言开发核心逻辑</p>
<p>- 必须使用WebAssembly技术</p>
<p>- 必须选择 Injective 区块链平台（CosmWasm 生态，CW20/CW721 标准）</p>
<p>- 必须实现比特承诺协议</p>
<p>- **必须实现NFT类型控制应用场景的机制**</p>
<p>- **必须实现NFT全局状态变量管理**</p>
<br/>
<h3>4.2 法律约束</h3>
<p>- 遵守相关数据保护法规</p>
<p>- 确保用户隐私权</p>
<p>- 符合区块链相关法律法规</p>
<br/>
<h3>4.3 业务约束</h3>
<p>- 系统部署成本控制在合理范围内</p>
<p>- 支持多语言界面</p>
<p>- 提供完整的审计日志</p>
<p>- **支持NFT类型的动态扩展和升级**</p>
<br/>
<h2>5. 验收标准</h2>
<br/>
<h3>5.1 功能验收</h3>
<p>- 所有功能需求得到完整实现</p>
<p>- 用户界面友好易用</p>
<p>- 系统文档完整准确</p>
<p>- **NFT类型控制应用场景功能正常工作**</p>
<p>- **NFT分发替代用户注册功能正常工作**</p>
<p>- **NFT全局状态变量控制比特承诺功能正常工作**</p>
<p>- iAgent自动化功能正常工作，支持多种自动化策略和触发条件</p>
<br/>
<h3>5.2 性能验收</h3>
<p>- 满足所有性能需求指标</p>
<p>- 通过压力测试验证</p>
<p>- 支持预期用户规模</p>
<p>- **支持多种NFT类型的并发处理**</p>
<p>- iAgent自动化操作响应时间满足要求，支持并发自动化任务处理</p>
<p>- **多目标选择系统性能验收**：支持10000+参与者同时参与，批量操作优化，异步处理架构</p>
<p>- **去中心化原则验收**：提供审计材料与证明，验证五大原则在各应用场景下成立</p>
<br/>
<h3>5.3 安全验收</h3>
<p>- 通过安全审计</p>
<p>- 隐私保护机制有效</p>
<p>- 抗攻击能力验证</p>
<p>- **NFT状态管理安全性得到验证**</p>
<p>- iAgent自动化操作的安全性得到验证，防止未授权访问和恶意操作</p>
<br/>
<h2>6. 风险评估</h2>
<br/>
<h3>6.1 技术风险</h3>
<p>- 区块链性能瓶颈</p>
<p>- 密码学算法安全性</p>
<p>- WebAssembly兼容性问题</p>
<p>- **NFT类型扩展的复杂性**</p>
<p>- **NFT状态管理的一致性风险**</p>
<br/>
<h3>6.2 业务风险</h3>
<p>- 用户接受度</p>
<p>- 监管政策变化</p>
<p>- 竞争环境变化</p>
<br/>
<h3>6.3 风险缓解措施</h3>
<p>- 技术方案充分验证</p>
<p>- 合规性持续监控</p>
<p>- 用户反馈及时响应</p>
<p>- **NFT类型设计的标准化和规范化**</p>
<p>- **NFT状态管理的多重验证机制**</p>
<br/>
<p>---</p>
<br/>
<p>**文档编制日期**：2025年8月</p>
<p>**文档编制人**：luckeeDAO技术评估团队</p>
<p>**文档审核人**：luckeeDAO管理委员会</p>
</body>
</html>