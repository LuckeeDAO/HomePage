<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>技术白皮书</title>
    <style>
        body {
            max-width: 860px;
            margin: 32px auto;
            padding: 0 16px;
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #1f2937;
        }
        pre { background:#f8fafc; padding:12px; overflow:auto; border-radius:6px; }
        code { background:#f1f5f9; padding:2px 4px; border-radius:4px; }
        h1,h2,h3,h4,h5,h6 { line-height:1.25; }
        a { color:#2563eb; text-decoration:none; }
        a:hover { text-decoration:underline; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #e5e7eb; padding: 8px; }
        blockquote { margin: 0; padding-left: 1em; border-left: 4px solid #e5e7eb; color:#6b7280; }
    </style>
</head>
<body>
<h1>基于比特承诺模型的去中心化投票与抽奖系统技术白皮书</h1>
<br/>
<p>> 用词规范：术语以《项目术语表》为准；本文为对现有体系化技术文档（需求、概要、详细设计与技术选型）的凝练整合，面向技术与业务决策者。</p>
<br/>
<h2>1. 摘要（Abstract）</h2>
<br/>
<p>本白皮书提出一套基于比特承诺模型（Bit Commitment）的去中心化决策投票与抽奖系统。系统以Rust+WebAssembly提供高性能计算，以区块链（基于CosmWasm/Injective）提供不可篡改的最小化上链记录，以IPFS提供可验证的去中心化明细存储；通过NFT类型驱动的架构抽象，将抽奖、彩票、分配、治理等多种应用场景统一在同一技术底座之上；并以$LUCKEE 代币进行权限控制、以CW721 NFT承载参与资格与会话配置引用，实现隐私保护、透明可验证与大规模可扩展的多目标选择（n 选 k）能力。</p>
<br/>
<p>> 范围声明（Phase 1）：第一期仅交付去中心化抽奖功能（单目标选择 n 选 1 与多目标选择 n 选 k）。彩票、分配、治理等场景为后续迭代内容。</p>
<br/>
<h2>2. 背景与动机</h2>
<br/>
<p>- 去中心化决策的关键难题在于：在隐私保护前提下汇总全体参与者偏好，并确保最终结果不依赖任何一部分（无论多数或少数）。</p>
<p>- 传统中心化方案在信任、审计与抗篡改方面存在先天不足，且难以公平覆盖超大规模参与者。</p>
<p>- 本系统通过“承诺-揭示”范式与链上/链下分层存储，提供高透明度、强可验证与低成本的技术解法。</p>
<br/>
<h3>我们对“去中心化”的定义与五大原则</h3>
<p>- 分散与平等：每个参与者的决策权形式上完全平等，对结果影响同等重要。</p>
<p>- 全员一致性共识：任何结果均由全体参与者偏好叠加产生，无外部少数裁决权。</p>
<p>- 抗合谋与抗操纵：协议与规则防止任何规模子集（含51%/99%）通过联合行动主导/篡改结果。</p>
<p>- 偏好显示自由性：任何参与者不能通过伪造偏好获得绝对额外收益。</p>
<p>- 透明与可验证：提案、投票与决策过程对全体透明，人人可独立验证结果真实性与合法性。</p>
<br/>
<h2>3. 设计原则</h2>
<br/>
<p>- 隐私优先：偏好在揭示前对第三方不可见（比特承诺）。</p>
<p>- 去中心化：最小必要记录上链；全流程可第三方验证，避免单点信任。</p>
<p>- 可验证性：哈希/Merkle+CID 指针保证链上对链下数据的完整性校验。</p>
<p>- 高性能：Rust+WASM 并行化处理；批处理与缓存策略。</p>
<p>- 可扩展性：NFT类型抽象承载不同场景；统一状态机；组件化模块。</p>
<p>- 代币权限控制：基于$LUCKEE 持有量分级权限；支持质押/锁定。</p>
<p>- 自动化：iAgent 负责承诺/揭示自动化，降低操作门槛。</p>
<p>- 去中心化五原则落地：在架构、协议与实现层确保分散与平等、全员一致性、抗合谋与抗操纵、偏好显示自由性、透明与可验证。</p>
<br/>
<h2>4. 总体架构</h2>
<br/>
<p>- 客户端与SDK：偏好提交、验证工具、连接与签名、NFT/NFT类型接口。</p>
<p>- WebAssembly 服务：会话/状态编排、承诺/揭示处理、中奖/选择计算、区块链与IPFS 适配。</p>
<p>- 区块链合约：CW20 代币、CW721 NFT、比特承诺/自动化/状态合约适配层。</p>
<p>- 去中心化存储（IPFS）：承载承诺/揭示明细、参与者列表、计算过程与证明、会话配置版本与审计日志。</p>
<br/>
<p>系统以“链上最小集 + 链下可验证明细”为核心策略：链上仅存账户-NFT 关联与结果摘要/哈希/CID 与必要索引，所有大体量与可审计明细均存IPFS，通过CID 做唯一内容寻址与版本化。</p>
<br/>
<h2>5. 关键技术</h2>
<br/>
<h3>5.1 比特承诺协议</h3>
<p>- 承诺：c = H(m || r)，其中 m 为偏好/随机数，r 为随机盐。</p>
<p>- 揭示：公开 m 与 r，任何人可复算 H(m || r) 与 c 校验一致。</p>
<p>- 特性：绑定性与隐藏性，保证揭示前隐私、揭示后可验证。</p>
<br/>
<h3>5.2 多目标选择（n 选 k）与抽奖</h3>
<p>- 唯一中奖是 n 选 1，它是 n 选 k 的特例；多等级选择（多组多目标选择）是多个 n 选 k 的编排。</p>
<p>- 计算基元：参与者值聚合（如随机数总和对参与者数取余）+ 防冲突算法生成 k 个互异中奖序号；或按类型使用哈希/权重/分层等策略。</p>
<p>- 结果公开验证：提供过程证明与可复算路径，第三方可在IPFS 明细与链上摘要间交叉验证。</p>
<p>- 形式化规范：采用 Φ 规范化（Φ(x,n)=((x mod n)+n) mod n）、0→n 显示映射与 nextUnique 唯一化算子；列和 S_j 与偏移 O_j 的定义与审计轨迹见《技术选型/多目标选择技术实现方案.md》3.A。</p>
<br/>
<h3>5.2.1 域分离与盐（抗操纵）</h3>
<p>- 列级域标签 domain_j 与独立 salt_j，结合会话上下文 ctx（会话ID、NFT类型、配置CID、区块高度）进行哈希聚合，抵御重放与碰撞构造。</p>
<br/>
<h3>5.3 NFT类型驱动的场景抽象</h3>
<p>- NFT 类型（Type）承载“应用场景配置”的抽象（抽奖/彩票/分配/治理等）。</p>
<p>- 投票/抽奖“项目”不是独立模块，而是 NFT 管理的属性接口：配置为“NFT类型的全局参数”，以CID/版本引用。</p>
<p>- 资格以“账户- NFT 持有”判定；NFT 元数据引用会话配置CID 与结果摘要。</p>
<br/>
<h3>5.4 统一NFT决策状态机</h3>
<p>Draft → CommitOpen → CommitClosed → RevealOpen → Revealed → Tallied → Executed → Archived</p>
<p>- 与时间窗口与权限规则绑定；审计事件在状态迁移时产生。</p>
<p>- 时间语义：以链上区块时间为权威；迟到/缺席策略可配置（如揭示宽限期）。</p>
<br/>
<h3>5.5 代币权限控制（CW20）</h3>
<p>- 基于$LUCKEE 持有量进行权限分级（Basic/Creator/Admin）。</p>
<p>- 创建或更新NFT类型配置需满足阈值；支持质押/锁定扩展。</p>
<br/>
<h3>5.6 去中心化存储（IPFS）与链上最小化</h3>
<p>- IPFS 保存明细；链上仅保存摘要/索引（CID/哈希、少量统计）。</p>
<p>- Merkle/哈希验证链路：客户端/审计者可验证IPFS内容与链上摘要一致。</p>
<p>- 单一真实源（SoT）：以 IPFS 的 CID/版本 作为配置与明细的唯一真实源；链上仅保留可验证引用与必要索引。</p>
<br/>
<h3>5.8 资源决策（竞用性/非竞用性）</h3>
<p>- 竞用性：最大权匹配/匈牙利/网络流等实现容量约束的互斥分配；生成匹配边集合与可行/（近）最优性证明产物。</p>
<p>- 非竞用性：阈值通过 + 预算约束的子集选择（背包/近似），以 Σ f(S_g) 最大化；输出阈值/预算可行性与（近）最优性证明。</p>
<br/>
<h3>5.9 权重与快照</h3>
<p>- 权重来源（可配置）：等权、NFT权重、CW20 余额、快照高度余额（推荐）。</p>
<p>- 快照：在区块高度 h 固定权重，避免投票期间转移操纵；配置记录 snapshotHeight。</p>
<br/>
<h3>5.7 iAgent 自动化</h3>
<p>- 自动承诺：立即/定时/条件/批量。</p>
<p>- 自动揭示：时间/参与度/完成度/智能触发。</p>
<p>- 审计与回放：全流程日志与重放能力，降低人为失误。</p>
<br/>
<h2>6. 模块与接口</h2>
<br/>
<p>- 密码学核心：承诺协议、随机数、安全哈希、中奖序号生成。</p>
<p>- NFT 类型与状态：类型注册、全局状态变量、状态转换校验。</p>
<p>- NFT 管理：铸造、元数据、资格验证、中奖序号写回。</p>
<p>- 多目标选择/抽奖：等级配置、候选去重、序号分配、防冲突。</p>
<p>- WASM 服务：生命周期管理、区块链接口、IPFS 适配、批处理。</p>
<p>- 合约接口：代币/NFT/自动化/状态/比特承诺执行消息与查询消息。</p>
<p>- SDK：偏好封装、签名与提交、验证、类型化会话适配、事件监听。</p>
<br/>
<h2>7. 数据与存储模型</h2>
<br/>
<p>- 链上（最小集）：</p>
<p>  - 账户-NFT 关联（持有/转移事件与当前所有权）</p>
<p>  - 结果摘要（结果哈希/CID、必要统计摘要）</p>
<p>  - 索引指针（指向IPFS 的CID）</p>
<p>- 链下（IPFS 明细）：</p>
<p>  - 承诺/揭示全量记录、参与者、计算过程与证明、审计日志</p>
<p>  - NFT 类型的配置版本、会话参数、自动化配置与执行记录</p>
<p>  - NFT 元数据（含中奖序号、配置引用CID/版本、状态）</p>
<br/>
<h2>8. 安全与隐私</h2>
<br/>
<p>- 隐私：承诺-揭示机制；端到端加密传输。零知识证明不在本系统技术范围且不作为选项。</p>
<p>- 完整性：哈希/Merkle 校验；多副本冗余与Pin 策略。</p>
<p>- 合约安全：标准实现、审计、形式化验证与权限白名单。</p>
<p>- 防重放与重入：Nonce 与幂等策略、事务性状态更新。</p>
<p>- 代币/NFT 安全：余额与所有权查询校验、状态一致性约束。</p>
<p>- 自动化安全：iAgent 身份鉴别与授权、可撤销与回滚。</p>
<p>- 抗合谋与抗操纵：列域分离/独立盐/顺延唯一机制与公开审计，防止子集合谋影响唯一性或可验证性。</p>
<br/>
<h2>9. 性能与扩展性指标</h2>
<br/>
<p>- 响应：偏好提交 ≤ 3s；揭示 ≤ 8s（1000参与者）。</p>
<p>- 吞吐：1000+ TPS（链外处理/WASM 并行、批量入链）。</p>
<p>- 扩展：百万级参与者；10,000+ 并发会话观测。</p>
<p>- 抽奖：1000人/10目标计算 ≤ 10s；验证 ≤ 5s。</p>
<br/>
<h2>10. 典型流程（抽奖）</h2>
<br/>
<p>1) 分发抽奖NFT → 2) 提交随机数承诺 → 3) 揭示随机数 → 4) 计算 n 选 k 中奖序号 → 5) 写回NFT 元数据与结果摘要 → 6) 第三方验证（链上摘要 ↔ IPFS 明细）。</p>
<br/>
<h2>11. 代币经济与治理（概述）</h2>
<br/>
<p>- 权限与激励：$LUCKEE 持有量与质押影响权限与费用减免。</p>
<p>- 治理：以治理型NFT 类型承载提案/投票参数，链下明细 + 链上摘要治理。</p>
<br/>
<h3>11.1 代币经济（$LUCKEE）</h3>
<p>- 实用性（Utility）：</p>
<p>  - 权限分级：Basic/Creator/Admin（影响NFT类型创建、参数变更等）。</p>
<p>  - 手续费抵扣：平台费用按持仓与质押比例折扣。</p>
<p>  - 抵押与锁仓：敏感操作需锁仓期作为安全缓冲（可被罚没以惩戒恶意行为）。</p>
<p>- 资金流向（示例模板）：</p>
<p>  - 手续费：按交易量与操作复杂度计费，进入金库（Treasury）。</p>
<p>  - 奖励池：用于审计人/验证人激励（结果验证与审计报告提交）。</p>
<p>- 发行与分配（参数化占位）：</p>
<p>  - 初始供给、释放曲线与团队/社区比例由治理提案确定（非本阶段硬编码）。</p>
<br/>
<h3>11.2 治理机制（NFT类型驱动）</h3>
<p>- 治理载体：治理型NFT 类型定义治理参数（提案类别、阈值、投票/揭示时间窗）。</p>
<p>- 提案生命周期：Draft → Active → CommitOpen → RevealOpen → Tallied → Executed → Archived。</p>
<p>- 决策规则：</p>
<p>  - 法定人数（Quorum）：最低有效投票权重占比（参数化）。</p>
<p>  - 通过阈值（Threshold）：赞成权重/得分超过阈值（可为加权偏好模型）。</p>
<p>  - 冲突处理：同窗期冲突提案按优先级/互斥关系裁剪。</p>
<p>- 审计与执行：</p>
<p>  - 审计报告以 CID/版本 上链引用，合约仅存摘要/指针。</p>
<p>  - 通过的提案触发链上参数/白名单/金库拨付等执行消息。</p>
<br/>
<h2>12. 合规与风险</h2>
<br/>
<p>- 数据保护：GDPR/中国网安法遵循；数据最小化、可删除与可携带。</p>
<p>- 区块链监管：不发行证券型代币；技术中立与备案合规路线。</p>
<p>- 主要风险：链性能瓶颈、合约漏洞、自动化失误；对应对策为多链容灾、审计与熔断、人工兜底与回滚。</p>
<br/>
<h3>12.1 风险扩展与缓解（与可行性报告对齐）</h3>
<p>- IPFS 可用性波动：</p>
<p>  - 多网关与Pin冗余、自建节点 + 第三方Pinning、边缘缓存/CDN、分片并行拉取。</p>
<p>- 单一真实源（CID/版本）被破坏：</p>
<p>  - SoT 严格化：以 CID/版本 为唯一真实源；摘要/哈希/默克尔根交叉校验；变更强审计与多副本比对。</p>
<p>- 经济与治理合规：</p>
<p>  - 避免证券化发行；关键经济参数（供给、分配、费用）通过治理提案透明决策；</p>
<p>  - 针对不同法域进行合规评估与备案；可切换受限功能模式（如关闭对公众开放的交易功能）。</p>
<br/>
<h2>13. 实施路线</h2>
<br/>
<p>- 阶段化交付（聚焦抽奖）：基础架构 → 代币/NFT → 多等级选择 → 多目标选择（n选1/n选k）→ 核心功能 → 优化 → 集成测试。其他场景（彩票、分配、治理）在后续迭代纳入。</p>
<p>- 关键里程碑：端到端功能、性能与安全验收，文档与审计完成。</p>
<br/>
<h2>14. 对比与价值</h2>
<br/>
<p>- 相对中心化方案：消除单点信任，引入公开可验证性与抗篡改。</p>
<p>- 相对传统链上全量：显著降低Gas 与状态膨胀，保留可验证性。</p>
<p>- 创新点：NFT类型驱动多场景、统一状态机、iAgent 自动化、链上最小化 + 链下可审计。</p>
<br/>
<h2>15. 结论</h2>
<br/>
<p>本系统以“承诺-揭示 + NFT类型 + 去中心化存储 + 代币权限 + 自动化”为中心构件，第一期面向去中心化抽奖（n选1、n选k）交付，其他应用场景将在后续迭代扩展，在统一底座上逐步完善。</p>
<br/>
<p>---</p>
<br/>
<p>**文档编制日期**：2025年8月</p>
<p>**文档编制人**：luckeeDAO技术评估团队</p>
<p>**文档审核人**：luckeeDAO管理委员会</p>
</body>
</html>