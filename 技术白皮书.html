<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>技术白皮书</title>
    <style>
        body {
            max-width: 860px;
            margin: 32px auto;
            padding: 0 16px;
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #1f2937;
        }
        pre { background:#f8fafc; padding:12px; overflow:auto; border-radius:6px; }
        code { background:#f1f5f9; padding:2px 4px; border-radius:4px; }
        h1,h2,h3,h4,h5,h6 { line-height:1.25; }
        a { color:#2563eb; text-decoration:none; }
        a:hover { text-decoration:underline; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #e5e7eb; padding: 8px; }
        blockquote { margin: 0; padding-left: 1em; border-left: 4px solid #e5e7eb; color:#6b7280; }
    </style>
</head>
<body>
<h1 id="_1">基于比特承诺模型的去中心化投票与抽奖系统技术白皮书</h1>
<blockquote>
<p>用词规范：术语以《项目术语表》为准；本文为对现有体系化技术文档（需求、概要、详细设计与技术选型）的凝练整合，面向技术与业务决策者。</p>
</blockquote>
<h2 id="1-abstract">1. 摘要（Abstract）</h2>
<p>本白皮书提出一套基于比特承诺模型（Bit Commitment）的去中心化决策投票与抽奖系统。系统以Rust+WebAssembly提供高性能计算，以区块链（基于CosmWasm/Injective）提供不可篡改的最小化上链记录，以IPFS提供可验证的去中心化明细存储；通过NFT类型驱动的架构抽象，将抽奖、彩票、分配、治理等多种应用场景统一在同一技术底座之上；并以$LUCKEE 代币进行权限控制、以CW721 NFT承载参与资格与会话配置引用，实现隐私保护、透明可验证与大规模可扩展的多目标选择（n 选 k）能力。</p>
<blockquote>
<p>范围声明（Phase 1）：第一期仅交付去中心化抽奖功能（单目标选择 n 选 1 与多目标选择 n 选 k）。彩票、分配、治理等场景为后续迭代内容。</p>
</blockquote>
<h2 id="2">2. 背景与动机</h2>
<ul>
<li>去中心化决策的关键难题在于：在隐私保护前提下汇总全体参与者偏好，并确保最终结果不依赖任何一部分（无论多数或少数）。</li>
<li>传统中心化方案在信任、审计与抗篡改方面存在先天不足，且难以公平覆盖超大规模参与者。</li>
<li>本系统通过“承诺-揭示”范式与链上/链下分层存储，提供高透明度、强可验证与低成本的技术解法。</li>
</ul>
<h2 id="3">3. 设计原则</h2>
<ul>
<li>隐私优先：偏好在揭示前对第三方不可见（比特承诺）。</li>
<li>去中心化：最小必要记录上链；全流程可第三方验证，避免单点信任。</li>
<li>可验证性：哈希/Merkle+CID 指针保证链上对链下数据的完整性校验。</li>
<li>高性能：Rust+WASM 并行化处理；批处理与缓存策略。</li>
<li>可扩展性：NFT类型抽象承载不同场景；统一状态机；组件化模块。</li>
<li>代币权限控制：基于$LUCKEE 持有量分级权限；支持质押/锁定。</li>
<li>自动化：iAgent 负责承诺/揭示自动化，降低操作门槛。</li>
</ul>
<h2 id="4">4. 总体架构</h2>
<ul>
<li>客户端与SDK：偏好提交、验证工具、连接与签名、NFT/NFT类型接口。</li>
<li>WebAssembly 服务：会话/状态编排、承诺/揭示处理、中奖/选择计算、区块链与IPFS 适配。</li>
<li>区块链合约：CW20 代币、CW721 NFT、比特承诺/自动化/状态合约适配层。</li>
<li>去中心化存储（IPFS）：承载承诺/揭示明细、参与者列表、计算过程与证明、会话配置版本与审计日志。</li>
</ul>
<p>系统以“链上最小集 + 链下可验证明细”为核心策略：链上仅存账户-NFT 关联与结果摘要/哈希/CID 与必要索引，所有大体量与可审计明细均存IPFS，通过CID 做唯一内容寻址与版本化。</p>
<h2 id="5">5. 关键技术</h2>
<h3 id="51">5.1 比特承诺协议</h3>
<ul>
<li>承诺：c = H(m || r)，其中 m 为偏好/随机数，r 为随机盐。</li>
<li>揭示：公开 m 与 r，任何人可复算 H(m || r) 与 c 校验一致。</li>
<li>特性：绑定性与隐藏性，保证揭示前隐私、揭示后可验证。</li>
</ul>
<h3 id="52-n-k">5.2 多目标选择（n 选 k）与抽奖</h3>
<ul>
<li>唯一中奖是 n 选 1，它是 n 选 k 的特例；多等级选择（多组多目标选择）是多个 n 选 k 的编排。</li>
<li>计算基元：参与者值聚合（如随机数总和对参与者数取余）+ 防冲突算法生成 k 个互异中奖序号；或按类型使用哈希/权重/分层等策略。</li>
<li>结果公开验证：提供过程证明与可复算路径，第三方可在IPFS 明细与链上摘要间交叉验证。</li>
</ul>
<h3 id="53-nft">5.3 NFT类型驱动的场景抽象</h3>
<ul>
<li>NFT 类型（Type）承载“应用场景配置”的抽象（抽奖/彩票/分配/治理等）。</li>
<li>投票/抽奖“项目”不是独立模块，而是 NFT 管理的属性接口：配置为“NFT类型的全局参数”，以CID/版本引用。</li>
<li>资格以“账户- NFT 持有”判定；NFT 元数据引用会话配置CID 与结果摘要。</li>
</ul>
<h3 id="54-nft">5.4 统一NFT决策状态机</h3>
<p>Draft → CommitOpen → CommitClosed → RevealOpen → Revealed → Tallied → Executed → Archived
- 与时间窗口与权限规则绑定；审计事件在状态迁移时产生。</p>
<h3 id="55-cw20">5.5 代币权限控制（CW20）</h3>
<ul>
<li>基于$LUCKEE 持有量进行权限分级（Basic/Creator/Admin）。</li>
<li>创建或更新NFT类型配置需满足阈值；支持质押/锁定扩展。</li>
</ul>
<h3 id="56-ipfs">5.6 去中心化存储（IPFS）与链上最小化</h3>
<ul>
<li>IPFS 保存明细；链上仅保存摘要/索引（CID/哈希、少量统计）。</li>
<li>Merkle/哈希验证链路：客户端/审计者可验证IPFS内容与链上摘要一致。</li>
<li>单一真实源（SoT）：以 IPFS 的 CID/版本 作为配置与明细的唯一真实源；链上仅保留可验证引用与必要索引。</li>
</ul>
<h3 id="57-iagent">5.7 iAgent 自动化</h3>
<ul>
<li>自动承诺：立即/定时/条件/批量。</li>
<li>自动揭示：时间/参与度/完成度/智能触发。</li>
<li>审计与回放：全流程日志与重放能力，降低人为失误。</li>
</ul>
<h2 id="6">6. 模块与接口</h2>
<ul>
<li>密码学核心：承诺协议、随机数、安全哈希、中奖序号生成。</li>
<li>NFT 类型与状态：类型注册、全局状态变量、状态转换校验。</li>
<li>NFT 管理：铸造、元数据、资格验证、中奖序号写回。</li>
<li>多目标选择/抽奖：等级配置、候选去重、序号分配、防冲突。</li>
<li>WASM 服务：生命周期管理、区块链接口、IPFS 适配、批处理。</li>
<li>合约接口：代币/NFT/自动化/状态/比特承诺执行消息与查询消息。</li>
<li>SDK：偏好封装、签名与提交、验证、类型化会话适配、事件监听。</li>
</ul>
<h2 id="7">7. 数据与存储模型</h2>
<ul>
<li>链上（最小集）：</li>
<li>账户-NFT 关联（持有/转移事件与当前所有权）</li>
<li>结果摘要（结果哈希/CID、必要统计摘要）</li>
<li>索引指针（指向IPFS 的CID）</li>
<li>链下（IPFS 明细）：</li>
<li>承诺/揭示全量记录、参与者、计算过程与证明、审计日志</li>
<li>NFT 类型的配置版本、会话参数、自动化配置与执行记录</li>
<li>NFT 元数据（含中奖序号、配置引用CID/版本、状态）</li>
</ul>
<h2 id="8">8. 安全与隐私</h2>
<ul>
<li>隐私：承诺-揭示机制；端到端加密传输。零知识证明不在本系统技术范围且不作为选项。</li>
<li>完整性：哈希/Merkle 校验；多副本冗余与Pin 策略。</li>
<li>合约安全：标准实现、审计、形式化验证与权限白名单。</li>
<li>防重放与重入：Nonce 与幂等策略、事务性状态更新。</li>
<li>代币/NFT 安全：余额与所有权查询校验、状态一致性约束。</li>
<li>自动化安全：iAgent 身份鉴别与授权、可撤销与回滚。</li>
</ul>
<h2 id="9">9. 性能与扩展性指标</h2>
<ul>
<li>响应：偏好提交 ≤ 3s；揭示 ≤ 8s（1000参与者）。</li>
<li>吞吐：1000+ TPS（链外处理/WASM 并行、批量入链）。</li>
<li>扩展：百万级参与者；10,000+ 并发会话观测。</li>
<li>抽奖：1000人/10目标计算 ≤ 10s；验证 ≤ 5s。</li>
</ul>
<h2 id="10">10. 典型流程（抽奖）</h2>
<p>1) 分发抽奖NFT → 2) 提交随机数承诺 → 3) 揭示随机数 → 4) 计算 n 选 k 中奖序号 → 5) 写回NFT 元数据与结果摘要 → 6) 第三方验证（链上摘要 ↔ IPFS 明细）。</p>
<h2 id="11">11. 代币经济与治理（概述）</h2>
<ul>
<li>权限与激励：$LUCKEE 持有量与质押影响权限与费用减免。</li>
<li>治理：以治理型NFT 类型承载提案/投票参数，链下明细 + 链上摘要治理。</li>
</ul>
<h3 id="111-luckee">11.1 代币经济（$LUCKEE）</h3>
<ul>
<li>实用性（Utility）：</li>
<li>权限分级：Basic/Creator/Admin（影响NFT类型创建、参数变更等）。</li>
<li>手续费抵扣：平台费用按持仓与质押比例折扣。</li>
<li>抵押与锁仓：敏感操作需锁仓期作为安全缓冲（可被罚没以惩戒恶意行为）。</li>
<li>资金流向（示例模板）：</li>
<li>手续费：按交易量与操作复杂度计费，进入金库（Treasury）。</li>
<li>奖励池：用于审计人/验证人激励（结果验证与审计报告提交）。</li>
<li>发行与分配（参数化占位）：</li>
<li>初始供给、释放曲线与团队/社区比例由治理提案确定（非本阶段硬编码）。</li>
</ul>
<h3 id="112-nft">11.2 治理机制（NFT类型驱动）</h3>
<ul>
<li>治理载体：治理型NFT 类型定义治理参数（提案类别、阈值、投票/揭示时间窗）。</li>
<li>提案生命周期：Draft → Active → CommitOpen → RevealOpen → Tallied → Executed → Archived。</li>
<li>决策规则：</li>
<li>法定人数（Quorum）：最低有效投票权重占比（参数化）。</li>
<li>通过阈值（Threshold）：赞成权重/得分超过阈值（可为加权偏好模型）。</li>
<li>冲突处理：同窗期冲突提案按优先级/互斥关系裁剪。</li>
<li>审计与执行：</li>
<li>审计报告以 CID/版本 上链引用，合约仅存摘要/指针。</li>
<li>通过的提案触发链上参数/白名单/金库拨付等执行消息。</li>
</ul>
<h2 id="12">12. 合规与风险</h2>
<ul>
<li>数据保护：GDPR/中国网安法遵循；数据最小化、可删除与可携带。</li>
<li>区块链监管：不发行证券型代币；技术中立与备案合规路线。</li>
<li>主要风险：链性能瓶颈、合约漏洞、自动化失误；对应对策为多链容灾、审计与熔断、人工兜底与回滚。</li>
</ul>
<h3 id="121">12.1 风险扩展与缓解（与可行性报告对齐）</h3>
<ul>
<li>IPFS 可用性波动：</li>
<li>多网关与Pin冗余、自建节点 + 第三方Pinning、边缘缓存/CDN、分片并行拉取。</li>
<li>单一真实源（CID/版本）被破坏：</li>
<li>SoT 严格化：以 CID/版本 为唯一真实源；摘要/哈希/默克尔根交叉校验；变更强审计与多副本比对。</li>
<li>经济与治理合规：</li>
<li>避免证券化发行；关键经济参数（供给、分配、费用）通过治理提案透明决策；</li>
<li>针对不同法域进行合规评估与备案；可切换受限功能模式（如关闭对公众开放的交易功能）。</li>
</ul>
<h2 id="13">13. 实施路线</h2>
<ul>
<li>阶段化交付（聚焦抽奖）：基础架构 → 代币/NFT → 多等级选择 → 多目标选择（n选1/n选k）→ 核心功能 → 优化 → 集成测试。其他场景（彩票、分配、治理）在后续迭代纳入。</li>
<li>关键里程碑：端到端功能、性能与安全验收，文档与审计完成。</li>
</ul>
<h2 id="14">14. 对比与价值</h2>
<ul>
<li>相对中心化方案：消除单点信任，引入公开可验证性与抗篡改。</li>
<li>相对传统链上全量：显著降低Gas 与状态膨胀，保留可验证性。</li>
<li>创新点：NFT类型驱动多场景、统一状态机、iAgent 自动化、链上最小化 + 链下可审计。</li>
</ul>
<h2 id="15">15. 结论</h2>
<p>本系统以“承诺-揭示 + NFT类型 + 去中心化存储 + 代币权限 + 自动化”为中心构件，第一期面向去中心化抽奖（n选1、n选k）交付，其他应用场景将在后续迭代扩展，在统一底座上逐步完善。</p>
</body>
</html>